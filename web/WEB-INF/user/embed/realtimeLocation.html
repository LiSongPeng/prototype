<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../../../res/css/materialize.min.css">
    <script type="application/javascript" src="../../../res/js/jquery-3.0.0.min.js"></script>
    <script type="application/javascript" src="../../../res/js/materialize.min.js"></script>
    <script type="application/javascript" src="../../../res/js/angular.min.js"/>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=Bvgj1Wo4jtGKViBuE9V3MQVQUc4EzdTo"></script>
    <style type="text/css">
        body, html, #container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }
    </style>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=Bvgj1Wo4jtGKViBuE9V3MQVQUc4EzdTo"></script>
    <title>车辆信息</title>
</head>
<body ng-app="realTime" ng-controller="realTimeController">
<div id="container"></div>
<div id="chooseVehicle" class="modal modal-fixed-footer">
    <div class="modal-content">
        <div class="row">
            <div class="col s10 l10 offset-l1 offset-s1">
                <table id="terminals" class="bordered highlight centered">
                    <thead>
                    <tr id="searchBar">
                        <td colspan="2">
                            <input type="text" ng-model="searchKey"/>
                        </td>
                        <td><a class="waves-effect waves-purple btn-flat" ng-click="search()"></a></td>
                    </tr>
                    <tr>
                        <th>车辆编号</th>
                        <th>终端编号</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="terminal in pageBean.terminals">
                        <td>{{terminal.vehicle}}</td>
                        <td>{{terminal.id}}</td>
                        <td>
                            <input type="radio" name="terminal" id="{{terminal.id}}" ng-model="checked"/>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td>
                            <a class="waves-effect waves-purple btn-flat" ng-click="previousPage()">上一页</a>
                        </td>
                        <td><span>{{pageBean.currentPage}}</span></td>
                        <td>
                            <a class="waves-effect waves-purple btn-flat" ng-click="nextPage()">下一页</a>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a class="modal-action modal-close waves-effect waves-purple btn-flat" ng-click="confirm()">确认</a>
        <a class="modal-action modal-close waves-effect waves-purple btn-flat">取消</a>
    </div>
</div>
</body>
</html>
<script type="text/javascript">
    // 百度地图API功能
    var map = new BMap.Map("container");    // 创建Map实例
    map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
    map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
    var navigationControl = new BMap.NavigationControl({
        // 靠左上角位置
        anchor: BMAP_ANCHOR_TOP_LEFT,
        // LARGE类型
        type: BMAP_NAVIGATION_CONTROL_LARGE,
        // 启用显示定位
        enableGeolocation: true
    });
    map.addControl(navigationControl);
    // 添加定位控件
    var geolocationControl = new BMap.GeolocationControl();
    var preMarker;
    geolocationControl.addEventListener("locationSuccess", function (e) {
        // 定位成功事件
        var address = '';
        address += e.addressComponent.province;
        address += e.addressComponent.city;
        address += e.addressComponent.district;
        address += e.addressComponent.street;
        address += e.addressComponent.streetNumber;
        alert("当前定位地址为：" + address);
        if (!e.overlay) {
            var myIcon = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(22, 24), {
                offset: new BMap.Size(12, 20), // 指定定位位置
                imageOffset: new BMap.Size(1, 0 - 10 * 25) // 设置图片偏移
            });
            var marker = new BMap.Marker(e.point, {icon: myIcon});
            map.removeOverlay(preMarker);
            map.addOverlay(marker);
            preMarker = marker;
        }
    });
    geolocationControl.addEventListener("locationError", function (e) {
        // 定位失败事件
        alert(e.message);
    });
    map.addControl(geolocationControl);
    var menu = new BMap.ContextMenu();
    var txtMenuItem = [
        {
            text: '选择车辆进行显示',
            callback: function () {
                $('.modal').modal('open');
            }
        },
    ];
    for (var i = 0; i < txtMenuItem.length; i++) {
        menu.addItem(new BMap.MenuItem(txtMenuItem[i].text, txtMenuItem[i].callback, 100));
    }
    map.addContextMenu(menu);
    map.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
    /*    var point = new BMap.Point(116.404, 39.915);
        map.centerAndZoom(point,15);*/
    var realTime = angular.module('realTime', []);
    realTime.controller('realTimeController', ['$scope', '$http', function ($scope, $http) {
        $scope.search = function () {

        };
        $scope.previousPage = function () {

        };
        $scope.nextPage = function () {

        };
        $('.modal').modal({
            dismissible: false,
        });
    }]);
</script>